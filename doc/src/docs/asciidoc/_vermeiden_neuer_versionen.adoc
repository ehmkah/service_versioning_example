== Wie vermeide ich neue Versionen?

=== Consumer Driven Contract Tests

[%step]
* Geld und Zeit sparen:
** wenn erstellen einer neuen Version zwei Tage dauert, und ich durch einen Test herausfinden kann, dass ich die Änderung durchführen kann ohne eine neue Version zu erstellen, dann spare ich zweit Tage (dann sollten die Tests), die Kosten für die Clientanpassungen (mindestens Endpoints nicht einberechnet), ausserdem erlecihtert es die Kommunikation, wer was anpassen muss
* Konsumenten stellen Tests zur Verfügung, die ihre Erwartungen an den Service enthalten
* Tests laufen automatisiert bei ausgewählten Builds mit
* Tests erlauben Validierung der Struktur und des Inhalts
* wenn alle Konsumentne solche Tests zur Verfügung stellen, kann Service sich so lange verändern, wie nichts kaputt geht

* DEMO [Schematron für SOAP]
* https://martinfowler.com/articles/consumerDrivenContracts.html

=== Consumer Driven Contract Tests (PACT)

* Client schreibt, was er erwartet in einen Mockserver
* Client schreibt Test, dieser generiert eine "pact" Datei
* Pact Datei wird dem Service zur Verfügung gestellt
* Service führt die Pact Datei aus
* TODO : wie kann ich ein kleineres JSON verwenden, als das volle

=== Consumer Driven Contract Tests (PACT, DEMO)

* Schreiben eines Consumenten
* Starten des Tests
* Datei kopieren
* Spring boot starten
* änderungen an Servicedefinition vornehmen
* schauen, ob der Test noch läuft
* TODO : Pact Repository???? (da können die Consumenten Ihre Tests hochladen)

=== Consumer Driven Contract Test (Pact Broker)

* Tool erlaubt die einfache Verwaltung der Pacts
* nicht suprobiert

=== Alternativen zu Pact

* assertj-swagger (https://github.com/RobWin/assertj-swagger)
* swagger::diff (https://github.com/civisanalytics/swagger-diff)
* image:restassured_logo.png[] (http://rest-assured.io/)

=== Kleine Schnittstellen

[%step]
* wenn nicht rückwärtskompatible Änderungen auftreten ist die gesamte Schnittstelle betroffen
* grosse Schnittstellen haben die Tendenz, dass es Bereiche gibt, die sich nicht ändern
* umso kleiner die Schnittstelle, umso weniger weit kann sich eine nicht kompatible Änderung auswirken

[NOTE.speaker]
--
* Wir haben den Fehler gemacht, dass wir unsere Schnittstellen nicht klein genug gebaut haben
--

=== Kleine Schnittstellen

image:grosseSchnittstelle01.png[]

=== Kleine Schnittstellen

image:grosseSchnittstelle02.png[]

=== Kleine Schnittstellen

image:grosseSchnittstelle03.png[]

=== Magnificient Writer

* TODO
* DEMO
* http://tenderware.blogspot.ch/2011/05/magnanimous-writer.html

=== Tolerant Reader

[%step]
* ignorieren von Elementen, die Service nicht versteht
* Validierung gegen das WSDL ausschalten (erlaubt, dass ältere Versionen verwendet werden können)

* DEMO [REST]
** Zeigen, was passiert, wenn ein XML mit mehr Daten geschickt wird

* DEMO [REST]
** Zeigen was passiert, wenn ein JSON mit mehr Daten geschickt wird

[NOTE.speaker]
--
* Wir machen das zum Beispiel, wenn wir unseren Vertriebsservice vnext zur Verfügung stellen
* Die WSG validiert die Anfragen und Anfragen gegen kein Schema
--

=== Extension Points

* in soap world use of xsd:any element
* <xs:any namespace="##any"
                             processContents="lax"
                             minOccurs="0"
                             maxOccurs="unbounded"/>
* neue Attribute können hinzugefügt werden
* Nachteile:
** bei vielen any Elementen verschwindet der Sinn mit einer mit xsd definierten Schnittstelle